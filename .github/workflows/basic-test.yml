name: Basic Test

on:
  push:
    branches: [ main, master, develop ]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
        
    - name: Run Tests
      working-directory: ./backend
      run: |
        chmod +x mvnw
        ./mvnw clean test -B
        
    - name: Test Results Summary
      if: always()
      run: |
        echo "## 🧪 Test Execution Summary" >> $GITHUB_STEP_SUMMARY
        
        # Check if tests ran
        if [ -d "backend/target/surefire-reports" ]; then
          echo "✅ Tests executed successfully" >> $GITHUB_STEP_SUMMARY
          
          # Count files
          XML_COUNT=$(find backend/target/surefire-reports -name "TEST-*.xml" 2>/dev/null | wc -l)
          TXT_COUNT=$(find backend/target/surefire-reports -name "*.txt" 2>/dev/null | wc -l)
          
          echo "- XML Reports: $XML_COUNT" >> $GITHUB_STEP_SUMMARY
          echo "- Text Reports: $TXT_COUNT" >> $GITHUB_STEP_SUMMARY
          
          # Show test summary if available
          if [ -f backend/target/surefire-reports/*.txt ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### Test Summary:" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            head -10 backend/target/surefire-reports/*.txt >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          fi
        else
          echo "❌ No test reports found" >> $GITHUB_STEP_SUMMARY
        fi
        
    - name: Upload Reports
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-reports
        path: backend/target/surefire-reports/
        if-no-files-found: warn
