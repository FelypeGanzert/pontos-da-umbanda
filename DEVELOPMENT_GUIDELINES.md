# üìã **GUIDELINES DE DESENVOLVIMENTO - Pontos da Umbanda**

## üèóÔ∏è **Arquitetura & Design**

### **Simplicidade em Primeiro Lugar**
- **SEMPRE** priorizar arquitetura simples e direta
- Evitar over-engineering - implementar apenas o que √© necess√°rio
- Remover complexidades desnecess√°rias (√≠ndices desnecess√°rios, DTOs m√∫ltiplos, m√©todos n√£o utilizados)
- Seguir o princ√≠pio YAGNI (You Aren't Gonna Need It)

### **Padr√µes de C√≥digo**
- **Spring Boot**: Usar anota√ß√µes padr√£o (`@RestController`, `@Service`, `@Repository`)
- **Lombok**: Usar para reduzir boilerplate (`@Data`, `@Builder`, `@RequiredArgsConstructor`, `@Slf4j`)
- **MapStruct**: Preferir para mapeamento autom√°tico em vez de mappers manuais
- **Validation**: Usar Bean Validation (`@NotBlank`, `@Size`, `@NotNull`)

### **Estrutura de Camadas**
```
Controller ‚Üí Service ‚Üí Repository ‚Üí Entity
     ‚Üì         ‚Üì         ‚Üì          ‚Üì
   DTO ‚Üê  Mapper  ‚Üê  Entity  ‚Üê  Database
```

### **Relacionamentos JPA**
- **Usar `@ManyToOne`** com `@JoinColumn` para FKs
- **Lazy Loading** por padr√£o
- **Evitar** relacionamentos bidirecionais desnecess√°rios
- **N√£o** usar `@OneToMany` a menos que seja essencial para o neg√≥cio

## üß™ **Testes & Qualidade**

### **Cobertura de Testes Obrigat√≥ria**
- **Repository**: `@DataJpaTest` com `TestEntityManager`
- **Service**: `@ExtendWith(MockitoExtension.class)` com mocks
- **Controller**: `@WebMvcTest` com `@WithMockUser` para Spring Security

### **Padr√£o de Testes**
```java
// Repository Test
@DataJpaTest
@ActiveProfiles("test")
class EntityRepositoryTest { ... }

// Service Test  
@ExtendWith(MockitoExtension.class)
class EntityServiceTest { ... }

// Controller Test
@WebMvcTest(EntityController.class)
@WithMockUser
class EntityControllerTest { ... }
```

### **Qualidade de C√≥digo**
- **Encoding UTF-8**: Configurar em todas as camadas (Maven, Spring, testes)
- **Checkstyle**: Seguir padr√µes de c√≥digo definidos
- **Logs**: Usar `@Slf4j` com n√≠veis apropriados (`debug`, `info`, `warn`, `error`)

## üîß **Configura√ß√µes T√©cnicas**

### **Spring Boot Profiles**
- **`dev`**: Desenvolvimento com H2, console habilitado, logs debug, sem autentica√ß√£o
- **`test`**: Testes com configura√ß√µes limpas e logs silenciosos
- **`prod`**: Produ√ß√£o com seguran√ßa habilitada

### **Banco de Dados**
- **Desenvolvimento**: H2 em mem√≥ria com modo PostgreSQL
- **Schema**: `schema.sql` com `CREATE TABLE IF NOT EXISTS`
- **Dados**: `data.sql` com dados iniciais para desenvolvimento
- **Encoding**: UTF-8 em todas as configura√ß√µes
- **Auto-increment**: `BIGINT GENERATED BY DEFAULT AS IDENTITY`

### **Endpoints REST Padr√£o**
```java
// Apenas listar ativos (padr√£o m√≠nimo)
@GetMapping("/ativos")
public List<EntityDTO> findAllAtivos() { ... }

// CRUD completo (apenas se solicitado)
@GetMapping
@GetMapping("/{id}")
@PostMapping  
@PutMapping("/{id}")
@DeleteMapping("/{id}")
```

## üìù **Estrutura de Arquivos Obrigat√≥ria**

Para cada nova entidade, criar SEMPRE:

```
src/main/java/.../entity/Entity.java
src/main/java/.../dto/EntityDTO.java
src/main/java/.../mapper/EntityMapper.java (MapStruct)
src/main/java/.../repository/EntityRepository.java
src/main/java/.../service/EntityService.java
src/main/java/.../controller/EntityController.java

src/main/resources/schema.sql (atualizar)
src/main/resources/data.sql (atualizar)

src/test/java/.../repository/EntityRepositoryTest.java
src/test/java/.../service/EntityServiceTest.java
src/test/java/.../controller/EntityControllerTest.java
```

## ‚öôÔ∏è **Build & Deploy**

### **Maven**
- Configurar encoding UTF-8, profiles, annotation processors
- MapStruct + Lombok compatibility
- Surefire plugin configurado para UTF-8

### **Docker & CI/CD**
- Pipeline com testes, qualidade e security scan
- Containeriza√ß√£o opcional para produ√ß√£o

---

## üéØ **PADR√ïES DE IMPLEMENTA√á√ÉO**

### **Entity (JPA)**
```java
@Entity
@Table(name = "entities")
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class Entity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "parent_id", nullable = false)
    private ParentEntity parent;
    
    @Column(name = "ativo", nullable = false)
    @Builder.Default
    private Boolean ativo = true;
}
```

### **DTO**
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class EntityDTO {
    private Long id;
    private String nome;
    // Relacionamentos como IDs, n√£o objetos completos
    private Long parentId;
    private Boolean ativo;
}
```

### **Mapper (MapStruct)**
```java
@Mapper(componentModel = "spring")
public interface EntityMapper {
    
    @Mapping(source = "parent.id", target = "parentId")
    EntityDTO toDTO(Entity entity);
    
    List<EntityDTO> toDTOList(List<Entity> entities);
}
```

### **Repository**
```java
@Repository
public interface EntityRepository extends JpaRepository<Entity, Long> {
    List<Entity> findByAtivoTrue();
    // Apenas m√©todos essenciais
}
```

### **Service**
```java
@Service
@RequiredArgsConstructor
@Slf4j
public class EntityService {
    
    private final EntityRepository repository;
    private final EntityMapper mapper;
    
    @Transactional(readOnly = true)
    public List<EntityDTO> findAllAtivos() {
        log.debug("Buscando todas as entities ativas");
        List<Entity> entities = repository.findByAtivoTrue();
        return mapper.toDTOList(entities);
    }
}
```

### **Controller**
```java
@RestController
@RequestMapping("/api/v1/entities")
@RequiredArgsConstructor
@Slf4j
@Tag(name = "Entities", description = "API para gerenciamento de entities")
public class EntityController {

    private final EntityService service;

    @GetMapping("/ativos")
    @Operation(summary = "Listar entities ativos")
    public List<EntityDTO> findAllAtivos() {
        return service.findAllAtivos();
    }
}
```
